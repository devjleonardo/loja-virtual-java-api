<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org/">
  <head>
    <meta charset="UTF-8">
    
    <title>Checkout Loja Virtual</title>
    
    <link rel="stylesheet"
	      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	      
	<link rel="stylesheet"
		  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
		  
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.map"></script>
	
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script> 
  </head>
  <body>
    <div class="container">
      <form style="padding-top: 20px; padding-bottom: 20px" id="form-checkout">
        <input th:value="${venda.id}" type="hidden" id="idVenda">
      
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="nome">Nome:</label>
            <input 
              th:value="${venda.pessoa.nome}"
              type="text" 
              class="form-control" 
              id="nome" 
              style="height: 40px" 
              readonly="readonly" 
              required="required">
          </div>
          
          <div class="form-group col-md-6">
            <label for="email">E-mail: </label>
            <input 
              th:value="${venda.pessoa.email}"
              type="text" 
              class="form-control" 
              id="email" 
              style="height: 40px" 
              readonly="readonly" 
              required="required">
          </div>
        </div>
        
        <div class="form-row" id="linha-1-cartao">
          <div class="form-group col-md-6">
            <label for="numero-cartao">Número do cartão:</label>
            <input 
              type="text" 
              class="form-control" 
              id="numero-cartao" 
              placeholder="4950 3396 3352 5518"
              style="height: 40px" 
              required="required">
          </div>
          
          <div class="form-group col-md-6">
            <label for="nome-titular-cartao">Nome como escrito no cartão:</label>
            <input 
              type="text" 
              class="form-control" 
              id="nome-titular-cartao" 
              placeholder="João da Silva"
              style="height: 40px" 
              required="required">
          </div>
        </div>
        
        <div class="form-row" id="div-cpf">
          <div class="form-group col-md-12">
            <label for="cpf-titular-cartao">CPF do titular:</label>
            <input 
              type="text" 
              class="form-control" 
              id="cpf-titular-cartao" 
              placeholder="000.000.000-00"
              style="height: 40px" 
              required="required">
          </div>
        </div>
        
        <div class="form-row" id="linha-2-cartao">
          <div class="form-group col-md-4">
            <label for="mes-validade-cartao">Mês de validade:</label>
            <select 
              class="form-control" 
              id="mes-validade-cartao" 
              style="height: 40px" 
              required="required">
                <option value="01">01</option>
                <option value="02">02</option>
                <option value="03">03</option>
                <option value="04">04</option>
                <option value="05">05</option>
                <option value="06">06</option>
                <option value="07">07</option>
                <option value="08">08</option>
                <option value="09">09</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
              </select>
          </div>
          
          <div class="form-group col-md-4">
            <label for="ano-validade-cartao">Ano de validade:</label>
            <select 
              class="form-control" 
              id="ano-validade-cartao" 
              style="height: 40px" 
              required="required">
                <option value="2024">24</option>
                <option value="2025">25</option>
                <option value="2026">26</option>
                <option value="2027">27</option>
                <option value="2028">28</option>
                <option value="2029">29</option>
                <option value="2030">30</option>
                <option value="2031">31</option>
                <option value="2032">32</option>
                <option value="2033">33</option>
                <option value="2034">34</option>
                <option value="2035">35</option>
                <option value="2036">36</option>
                <option value="2037">37</option>
                <option value="2038">38</option>
                <option value="2039">39</option>
                <option value="2040">40</option>
              </select>
          </div>
          
          <div class="form-group col-md-4">
            <label for="cvv-cartao">Código de seguranç ou CVV:</label>
            <input 
              type="text" 
              class="form-control" 
              id="cvv-cartao" 
              placeholder="380" 
              style="height: 40px" 
              required="required">
          </div>
        </div>
        
        <div class="form-row"> 
          <div class="form-group col-md-12">
            <label for="quantidade-parcela">Selecione o número de parcelas:</label>
            <select class="form-control" id="quantidade-parcela" style="height: 40px" 
                    required="required">
                <option value="1">1x</option>
                <option value="2">2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
                <option value="5">5x</option>
                <option value="6">6x</option>
                <option value="7">7x</option>
                <option value="8">8x</option>
                <option value="9">9x</option>
                <option value="10">10x</option>
                <option value="11">11x</option>
                <option value="12">12x</option>
              </select>
          </div>
        </div>
        
        <div class="form-row" id="div-endereco"> 
          <div class="form-group col-md-4">
            <label for="cep-endereco-cobranca">CEP de cobrança:</label>
            <input 
              type="text" 
              class="form-control" 
              id="cep-endereco-cobranca" 
              placeholder="00000-000" 
              style="height: 40px" 
              required="required">
          </div>
          
          <div class="form-group col-md-4">
            <label for="rua-endereco-cobranca">Rua:</label>
            <input 
              type="text" 
              class="form-control" 
              id="rua-endereco-cobranca" 
              style="height: 40px" 
              required="required">
          </div>
          
          <div class="form-group col-md-4">
            <label for="numero-endereco-cobranca">Número:</label>
            <input 
              type="text" 
              class="form-control" 
              id="numero-endereco-cobranca" 
              style="height: 40px" 
              required="required">
          </div>
        </div>
        
        <div class="form-row" id="div-endereco2"> 
       	  <div class="form-group col-md-6">
            <label for="estado-endereco-cobranca">Estado:</label>
            <input 
              type="text" 
              class="form-control" 
              id="estado-endereco-cobranca" 
              placeholder="PR" 
              style="height: 40px" 
              required="required">
          </div>
          
          <div class="form-group col-md-6">
            <label for="cidade-endereco-cobranca">Cidade:</label>
            <input 
              type="text" 
              class="form-control" 
              id="cidade-endereco-cobranca" 
              placeholder="Maringá" 
              style="height: 40px" 
              required="required">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group col-md-12">
            <input 
              onclick="realizarPagamento();"
              type="button" 
              class="btn btn-primary btn-lg" 
              value="Realizar Pagamento" 
              style="font-size: 23px; height: 50px; width: 100%">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group col-md-6">
            <span 
              id="valor-compra" 
              th:text="@{'TOTAL R$: ' + ${venda.valorTotal}}"
              style="font-size: 19px; height: 30px; width: 100%"></span>
          </div>
          
          <div class="form-group col-md-6">
            <span 
              id="valor-desconto" 
              th:text="@{'DESCONTO R$: ' + ${venda.valorDesconto}}"
              style="font-size: 19px; height: 30px; width: 100%"></span>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group col-md-6">
            <span 
              id="valor-frete" 
              th:text="@{'FRETE R$: ' + ${venda.valorFrete}}"
              style="font-size: 19px; height: 30px; width: 100%"></span>
          </div>
        </div>
        
        <hr width="96%" style="color: #726868; border-top: 1px solid #726868;">
        
        <div class="form-row">
          <div class="form-group col-md-6" style="margin-top: 8px;">
            <label>Itens adicionados</label>
            <div th:each="item : ${venda.itensVendaLojaDTO}">
              <span 
                th:text="@{${item.produto.nome} + ' - Quantidade: ' + ${item.quantidade}}" 
                style="height: 15px; width: 100%; font-size: 11px">
              </span>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <script>
	  $(document).ready(function() {
        
		$('#numero-cartao').mask('0000 0000 0000 0000', {reverse: true});
		$('#cpf-titular-cartao').mask('000.000.000-00', {reverse: true});
		$('#cep-endereco-cobranca').mask('00000-000', {reverse: true});
		$('#cvv-cartao').mask('000', {reverse: true});
		  
	    function limpa_formulário_cep() {
	      // Limpa valores do formulário de cep.
	      $("#rua-endereco-cobranca").val("");
	      $("#numero-endereco-cobranca").val("");
	      $("#estado-endereco-cobranca").val("");
	      $("#cidade-endereco-cobranca").val("");
	    }
	
	    // Quando o campo cep perde o foco.
	    $("#cep-endereco-cobranca").blur(function() {
	
	      // Nova variável "cep" somente com dígitos.
	      var cep = $(this).val().replace(/\D/g, '');
	
	      // Verifica se campo cep possui valor informado.
	      if (cep != "") {
	
	        // Expressão regular para validar o CEP.
	        var validacep = /^[0-9]{8}$/;
	
	        // Valida o formato do CEP.
	        if(validacep.test(cep)) {
	
	          // Preenche os campos com "..." enquanto consulta webservice.
	      	  $("#rua-endereco-cobranca").val("...");
	          $("#estado-endereco-cobranca").val("...");
	          $("#cidade-endereco-cobranca").val("...");
	
	          // Consulta o webservice viacep.com.br/
	          $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {
	
	            if (!("erro" in dados)) {
	              // Atualiza os campos com os valores da consulta.
	              $("#rua-endereco-cobranca").val(dados.logradouro);
	              $("#estado-endereco-cobranca").val(dados.uf);
	              $("#cidade-endereco-cobranca").val(dados.localidade);
	            } // end if.
	            else {
	              // CEP pesquisado não foi encontrado.
	              limpa_formulário_cep();
	              alert("CEP não encontrado.");
	            }
	          });
	        } // end if.
	        else {
	          // CEP é inválido.
	          limpa_formulário_cep();
	          alert("Formato de CEP inválido.");
	        }
	      } // end if.
	      else {
	        // CEP sem valor, limpa formulário.
	        limpa_formulário_cep();
	      }
	    });
	  });
  
	  function realizarPagamento() {
		  var idVenda = $('#idVenda').val();
		  
		  var numeroCartao = $('#numero-cartao').val();
		  var nomeTitularCartao = $('#nome-titular-cartao').val();
		  var cpfTitularCartao = $('#cpf-titular-cartao').val();
		  
		  var mesValidadeCartao = $('#mes-validade-cartao').val();
		  var anoValidadeCartao = $('#ano-validade-cartao').val();
		  var cvvCartao = $('#cvv-cartao').val();
		  var quantidadeParcela = $('#quantidade-parcela').val();
		  
		  var cepEnderecoCobranca = $('#cep-endereco-cobranca').val();
		  var ruaEnderecoCobranca = $('#rua-endereco-cobranca').val();
		  var numeroEnderecoCobranca = $('#numero-endereco-cobranca').val();
		  var estadoEnderecoCobranca = $('#estado-endereco-cobranca').val();
		  var cidadeEnderecoCobranca = $('#cidade-endereco-cobranca').val();
		  
		  if (numeroCartao.trim() == '') {
			  alert('Informe o número do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (nomeTitularCartao.trim() == '') {
			  alert('Informe o nome do titular escrito no cartão de crédito.');
			  
			  return;
		  }
		  
		  if (cpfTitularCartao.trim() == '') {
			  alert('Informe o CPF do titular cartão de crédito.');
			  
			  return;
		  }
		  
		  if (mesValidadeCartao.trim() == '') {
			  alert('Informe o mês de validade do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (anoValidadeCartao.trim() == '') {
			  alert('Informe o ano de validade do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (cvvCartao.trim() == '') {
			  alert('Informe o CVV do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (cepEnderecoCobranca.trim() == '') {
			  alert('Informe o CEP do endereço de cobrança do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (ruaEnderecoCobranca.trim() == '') {
			  alert('Informe a rua do endereço de cobrança do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (numeroEnderecoCobranca.trim() == '') {
			  alert('Informe o número do endereço de cobrança do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (estadoEnderecoCobranca.trim() == '') {
			  alert('Informe o estado do endereço de cobrança do cartão de crédito.');
			  
			  return;
		  }
		  
		  if (cidadeEnderecoCobranca.trim() == '') {
			  alert('Informe a cidade do endereço de cobrança do cartão de crédito.');
			  
			  return;
		  }
	  }
	  
    </script>
  </body>
</html>